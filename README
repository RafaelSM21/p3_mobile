# ğŸ“˜ Projeto â€” API + AutenticaÃ§Ã£o + Frontend + TDD (Node, Express, Prisma, JWT)

Este projeto implementa:

âœ” API completa em **Node.js + Express**
âœ” Banco de dados com **PostgreSQL + Prisma ORM**
âœ” AutenticaÃ§Ã£o com **JWT**
âœ” EstratÃ©gia de autenticaÃ§Ã£o com **Strategy Pattern**
âœ” Singleton para conexÃ£o com Prisma
âœ” CRUD de usuÃ¡rios
âœ” PermissÃµes (ADMIN vs USER)
âœ” Middleware de autenticaÃ§Ã£o
âœ” Frontend simples e responsivo para testar login, cadastro e administraÃ§Ã£o
âœ” Testes com **Jest** (TDD bÃ¡sico)

---

# ğŸ“‚ Estrutura do Projeto

```
projeto/
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ middlewares/
â”‚   â”œâ”€â”€ strategies/
â”‚   â”œâ”€â”€ db/
â”‚   â”œâ”€â”€ app.ts
â”‚   â””â”€â”€ server.ts
â”‚
â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ schema.prisma
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ styles.css
â”‚   â””â”€â”€ main.js
â”‚
â”œâ”€â”€ __tests__/
â”‚   â””â”€â”€ auth.test.ts
â”‚
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

---

# ğŸ¦ Banco de Dados â€” Prisma + PostgreSQL

Arquivo `schema.prisma`:

```prisma
model User {
  id       Int     @id @default(autoincrement())
  name     String
  email    String  @unique
  password String
  role     String  @default("USER")

  @@map("users")
}
```

Comandos:

```bash
npx prisma migrate dev
npx prisma generate
```

---

# ğŸ” AutenticaÃ§Ã£o â€“ JWT + Strategy Pattern

Existem duas estratÃ©gias de autenticaÃ§Ã£o:

### **1. EmailPasswordStrategy (padrÃ£o)**

Autentica um usuÃ¡rio normal usando email e senha.

### **2. MasterKeyStrategy**

AutenticaÃ§Ã£o especial usando uma chave mestra (`MASTER_KEY`) para criar usuÃ¡rios admin.

Arquivo `.env`:

```
DATABASE_URL="postgresql://..."
JWT_SECRET="seuSegredoAqui"
JWT_EXPIRES_IN="8h"
MASTER_KEY="SUA_CHAVE_MASTER"
```

---

# ğŸ‘¤ PermissÃµes de Acesso (Admin)

* UsuÃ¡rios comuns â†’ **USER**
* Administrador â†’ **ADMIN**

Somente administradores podem deletar usuÃ¡rios.

---

# ğŸ§ª TDD â€” Testes com Jest

Comando:

```bash
npm test
```

Os testes usam o `EmailPasswordStrategy` e verificam falhas e sucessos de login.

---

# ğŸ–¥ API Endpoints

### **AutenticaÃ§Ã£o**

| MÃ©todo | Rota             | DescriÃ§Ã£o              |
| ------ | ---------------- | ---------------------- |
| POST   | `/auth/register` | Cria usuÃ¡rio           |
| POST   | `/auth/login`    | Login normal ou master |

---

### **UsuÃ¡rios**

| MÃ©todo | Rota         | Requer login | Somente Admin |
| ------ | ------------ | ------------ | ------------- |
| GET    | `/users`     | âœ”            | âŒ             |
| GET    | `/users/:id` | âœ”            | âŒ             |
| DELETE | `/users/:id` | âœ”            | âœ”             |

---

# ğŸŒ Frontend Responsivo

O projeto possui um **frontend prÃ³prio** para testar registro, login, listagem e exclusÃ£o de usuÃ¡rios.

Local:

```
frontend/
  index.html
```

Exibe:

âœ” Tela de registro
âœ” Tela de login
âœ” Listagem de usuÃ¡rios (com token armazenado)
âœ” BotÃ£o â€œCriar Adminâ€ via MasterKey
âœ” ExclusÃ£o de usuÃ¡rio (se logado como admin)
âœ” Totalmente responsivo (mobile + desktop)

---

# â–¶ï¸ Como Rodar o Projeto

## 1. Instalar dependÃªncias

```bash
npm install
```

---

## 2. Configurar .env

```bash
DATABASE_URL="postgresql://..."
JWT_SECRET="dev_secret"
JWT_EXPIRES_IN="8h"
MASTER_KEY="MASTER123"
```

---

## 3. Criar banco

```bash
npx prisma migrate dev
```

---

## 4. Rodar a API

```bash
npm run dev
```

Servidor sobe em:

```
http://localhost:3000
```

---

# ğŸ–¥ 5. Rodar o Frontend (NOVO)

O frontend fica na pasta:

```
/frontend
```

Para rodar:

### âœ” Comando oficial:

```bash
npm run frontend
```

### âœ” Ou manualmente:

```bash
npx serve frontend
```

O site abrirÃ¡ em:

```
http://localhost:3000
ou
http://localhost:3001
```

(O `serve` escolhe automaticamente a porta.)

---

# ğŸ§ª 6. Rodar Testes (Jest)

```bash
npm test
```
